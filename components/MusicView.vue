<script setup lang="ts">
import type { Music } from "@/types"
import { formatSingers, formatTime } from "@/utils/format"
import { usePlaySettingStore } from "@/stores"
import { useMusicOper } from "@/composables/useMusicOper"

const playSettingStore = usePlaySettingStore()
const { playMusic, playVideo, addMusicToList, deleteMusicToList } =
    useMusicOper()
const { $love } = storeToRefs(playSettingStore)
const props = defineProps<{ music: Music }>()
</script>

<template>
    <div class="music__containner" @click="playMusic($event, props.music)">
        <img :src="props.music.avater" />
        <div class="music__info">{{ props.music.name }}</div>
        <div class="music__info">{{ formatSingers(props.music.singer) }}</div>
        <div style="margin: 0 50px">
            {{ formatTime(props.music.duration) }}
        </div>
        <svg
            v-if="isInList(props.music, $love.datas)"
            @click="deleteMusicToList(props.music, $love, $event)"
            viewBox="0 0 1024 1024"
            xmlns="http://www.w3.org/2000/svg"
            class="mini-icon"
        >
            <path
                d="M512 998.4c-19.2 0-38.4-12.8-38.4-19.2C454.4 966.4 128 640 83.2 595.2 32 537.6 0 467.2 0 396.8s32-147.2 83.2-198.4c51.2-51.2 121.6-83.2 198.4-83.2 76.8 0 147.2 32 198.4 83.2C492.8 211.2 505.6 224 512 236.8c6.4-12.8 19.2-25.6 32-38.4 51.2-51.2 121.6-83.2 198.4-83.2 76.8 0 147.2 32 198.4 83.2C992 249.6 1024 320 1024 396.8c0 76.8-32 147.2-83.2 198.4C896 640 569.6 966.4 550.4 979.2 550.4 985.6 531.2 998.4 512 998.4z"
                fill="#FF7878"
            ></path>
        </svg>
        <svg
            v-else
            @click="addMusicToList(props.music, $love, $event)"
            class="mini-icon"
            viewBox="0 0 1031 1024"
            xmlns="http://www.w3.org/2000/svg"
        >
            <path
                d="M515.38944 957.85984c-21.54496 0-36.87424-14.25408-40.76544-18.26816-17.62304-17.3568-347.25888-342.23104-392.43776-391.168C29.44 495.70816 0 424.6528 0 349.0816s29.44-146.62656 82.8928-200.06912c53.42208-53.43232 124.47744-82.87232 200.07936-82.87232 75.56096 0 146.60608 29.42976 200.05888 82.87232 11.90912 11.91936 22.7328 24.94464 32.3584 38.95296 9.6256-14.01856 20.44928-27.0336 32.34816-38.95296 53.44256-53.44256 124.49792-82.87232 200.07936-82.87232 75.56096 0 146.61632 29.42976 200.07936 82.87232 53.43232 53.46304 82.86208 124.50816 82.86208 200.06912 0 75.5712-29.42976 146.61632-82.86208 200.07936-44.50304 48.20992-374.23104 373.18656-391.74144 390.44096C552.28416 943.60576 536.9344 957.85984 515.38944 957.85984zM282.97216 117.34016c-61.92128 0-120.1152 24.10496-163.87072 67.87072C75.3152 228.98688 51.2 287.19104 51.2 349.0816c0 61.9008 24.1152 120.10496 67.8912 163.88096 45.33248 49.05984 388.28032 387.0208 391.7312 390.42048 0.256 0.24576 0.512 0.512 0.74752 0.768 0.82944 0.78848 2.72384 2.02752 3.81952 2.42688 1.10592-0.39936 3.05152-1.67936 4.16768-2.77504 3.86048-3.81952 346.79808-341.78048 391.43424-390.11328 44.47232-44.52352 68.56704-102.71744 68.56704-164.608s-24.10496-120.08448-67.87072-163.86048c-43.76576-43.76576-101.96992-67.87072-163.87072-67.87072s-120.10496 24.10496-163.88096 67.87072c-18.46272 18.4832-33.75104 40.32512-45.42464 64.9216-4.23936 8.92928-13.24032 14.63296-23.13216 14.63296l0 0c-9.89184 0-18.8928-5.70368-23.13216-14.63296-11.66336-24.576-26.94144-46.42816-45.44512-64.9216C403.0464 141.44512 344.86272 117.34016 282.97216 117.34016z"
            ></path>
        </svg>
        <!-- 播放视频 -->
        <svg
            v-if="props.music.video"
            @click="playVideo($event, props.music.video.id)"
            class="mini-icon"
            viewBox="0 0 1024 1024"
            xmlns="http://www.w3.org/2000/svg"
        >
            <path
                d="M814.545455 186.181818h-230.4l121.018181-86.109091c11.636364-6.981818 13.963636-20.945455 4.654546-32.581818-6.981818-11.636364-20.945455-13.963636-32.581818-4.654545l-165.236364 116.363636-165.236364-116.363636c-11.636364-6.981818-25.6-4.654545-32.581818 4.654545-6.981818 11.636364-4.654545 25.6 4.654546 32.581818L439.854545 186.181818H209.454545c-76.8 0-139.636364 62.836364-139.636363 139.636364v477.090909c0 76.8 62.836364 139.636364 139.636363 139.636364h605.09091c76.8 0 139.636364-62.836364 139.636363-139.636364V325.818182c0-76.8-62.836364-139.636364-139.636363-139.636364z m93.090909 616.727273c0 51.2-41.890909 93.090909-93.090909 93.090909H209.454545c-51.2 0-93.090909-41.890909-93.090909-93.090909V325.818182c0-51.2 41.890909-93.090909 93.090909-93.090909h605.09091c51.2 0 93.090909 41.890909 93.090909 93.090909v477.090909z"
            ></path>
            <path
                d="M686.545455 523.636364l-251.345455-144.290909c-6.981818-4.654545-16.290909-6.981818-23.272727-6.981819-23.272727 0-46.545455 18.618182-46.545455 46.545455v290.909091c0 27.927273 23.272727 46.545455 46.545455 46.545454 6.981818 0 16.290909-2.327273 23.272727-6.981818L686.545455 605.090909c30.254545-18.618182 30.254545-62.836364 0-81.454545z m-274.618182 186.181818V418.909091l251.345454 144.290909-251.345454 146.618182z"
            ></path>
        </svg>
        <div v-else class="mini-icon"></div>
        <svg
            class="mini-icon"
            viewBox="0 0 1024 1024"
            xmlns="http://www.w3.org/2000/svg"
        >
            <path
                d="M544.256 480.256h307.2a32.256 32.256 0 0 1 0 64h-307.2v307.2a32.256 32.256 0 0 1-64 0v-307.2h-307.2a32.256 32.256 0 1 1 0-64h307.2v-307.2a32.256 32.256 0 1 1 64 0z"
            ></path>
        </svg>
    </div>
</template>

<style scoped lang="scss">
$width: 1000px;
$height: 70px;
.music__containner {
    display: flex;
    align-items: center;
    justify-content: center;
    margin: 1px 20px !important;
    width: $width !important;
    height: $height !important;
    border-radius: 5px !important;
    cursor: pointer;
    img {
        margin: 0 15px 0 30px;
        width: 54px;
        height: 54px;
        border-radius: 5px;
        object-fit: cover;
    }
    .music__info {
        margin: 0 35px;
        width: 200px;
        font-size: 18px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }
    .mini-icon {
        @extend %iconBase;
        width: 22px;
        height: 22px;
    }
    &:hover {
        @include useTheme {
            background-color: getVar("selectedColor");
        }
    }
}
</style>
